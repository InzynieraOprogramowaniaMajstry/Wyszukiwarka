{% extends "base.html" %}

{% block content %}
<div id="app">

  <div class="alert alert-info" role="alert" text-align="center">
    <marquee  scrollmount="8"> Witaj w swojej bibliotece {{request.cookies.get('email')}} </marquee>
  </div>

  <v-app>
      <v-main>
    <template>
      <v-row justify="center">
        <v-dialog
          v-model="dialog"
          fullscreen
          hide-overlay
          transition="dialog-bottom-transition"
        >
          <template v-slot:activator="{ on, attrs }">
            <v-btn
              color="primary"
              dark
              v-bind="attrs"
              v-on="on"
            >
              Open your library
            </v-btn>
          </template>
          <v-card>
            <v-toolbar
              dark
              color="primary"
            >
              <v-btn
                icon
                dark
                @click="dialog = false"
              >
                <v-icon>mdi-close</v-icon>
              </v-btn>
              <v-toolbar-title>Your books</v-toolbar-title>
              <v-spacer></v-spacer>
              <v-toolbar-items>
                <v-btn
                  dark
                  text
                  @click="dialog = false"
                >
                  Exit library
                </v-btn>
              </v-toolbar-items>
            </v-toolbar>


            <div v-if="userBooks.length == 0" class="alert alert-warning m-3" rounded role="alert">
              You don't have any books in library now!
            </div>


            <template  v-if="userBooks.length > 0">
              <v-card>
                <v-card-title>
                    <v-text-field

                      v-model="mySearch"
                      append-icon="mdi-magnify"
                      label="Search"
                      single-line
                      hide-details
                    ></v-text-field>
                </v-card-title>
                <v-data-table
                  v-model="selected2"
                  :headers="headers"
                  :items="userBooks"
                  item-key="url"
                  :items-per-page="5"
                  :search="mySearch"
                  :single-select="singleSelect2"
                  class="elevation-1"
                  show-select
                >
                <template v-slot:top>
                  <v-switch
                    v-model="singleSelect2"
                    label="Check if you want to remove one book at once"
                    class="pa-3"
                  ></v-switch>
                </template>
                <template #item.url="{ value }">
                  <a target="_blank" :href="value">
                    [[ value ]]
                  </a>
                </template>

              </v-data-table>

            </v-card>
        </template>

          <v-btn v-if="selected2.length > 0"  @click="removeFromLibrary"  rounded block class="m-3" color="error" > Remove choosen books from your library </v-btn>


          </v-card>
        </v-dialog>
      </v-row>
    </template>
      </v-main>
    </v-app>
</div>
  {% endblock %}

{% block scripts %}
<script>
    new Vue({
      el: '#app',
      vuetify: new Vuetify(),
      delimiters: ['[[', ']]'],
      data () {
        return {
          dialog: false,



          userBooks: [],
          search: "",
          mySearch: "",
          singleSelect: false,
          singleSelect2: false,
          selected: [],
          selected2: [],
          books:[],
          loadingBooks:false,
            headers: [
          {
            text: 'Rodzaj literacki',
            align: 'start',
            sortable: true,
            value: 'kind',
          },
          { text: 'TytuÅ‚', value: 'title' },
          { text: 'Autor', value: 'author' },
          { text: 'URL', value: 'url' },
        ],

        }
      } ,
        mounted:function(){
          this.fetchBooks()
        },
        methods:{
        fetchBooks(){
        url = "https://wolnelektury.pl/api/books/"
        fetch(url)
        .then((response) => {
          console.log(response.ok)
          if (response.ok) {
            return response.json();
          }else{
            console.log( "Przpau")
          }
        })
        .then((data) => this.books = data)
        .finally(this.loadingBooks=false)
        },
        addToLibrary(){
          console.log(this.selected)
          for (let i = 0; i < this.selected.length ; i++) {
            if (this.userBooks.includes(this.selected[i])){

            }else{
              this.userBooks.push(this.selected[i])
            }
          }
          console.log(this.userBooks)

        },
        removeFromLibrary(){
          for (let i = 0; i < this.selected2.length ; i++) {
            if (this.userBooks.includes(this.selected2[i])){
              this.userBooks.splice(this.selected2[i],1)
            }else{
            }
          }
          console.log(this.userBooks)
          this.selected2= [];
        }
      }
    })
</script>
{% endblock %}